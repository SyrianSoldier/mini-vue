{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/until.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["const oldArrayMethods = Array.prototype\r\nconst protoMethods = Object.create(oldArrayMethods)\r\nconst methods = ['pop', 'push', 'unshift', 'shift', 'reverse', 'sort', 'splice']\r\n\r\nmethods.forEach((method) => {\r\n  protoMethods[method] = function (...args) {\r\n    let inserted = null\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n      default:\r\n        break\r\n    }\r\n    this.__ob__.arrayObserver(inserted)\r\n    return oldArrayMethods[method].apply(this, args) //执行原方法逻辑\r\n  }\r\n})\r\n\r\nexport { protoMethods }\r\n","export function defineProperty(target, attr, value) {\r\n  Object.defineProperty(target, attr, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}\r\n","import { protoMethods } from './array'\r\nimport { defineProperty } from '../until'\r\nclass Observer {\r\n  constructor(data) {\r\n    defineProperty(data, '__ob__', this) //做标记, 是否观测过\r\n\r\n    if (Array.isArray(data)) {\r\n      data.__proto__ = protoMethods //对数组的方法进行拦截\r\n      this.arrayObserver(data) //对数组中的对象类型进行观测\r\n    } else {\r\n      this.walk(data)\r\n    }\r\n\r\n    //所有的逻辑放在构造函数里,太臃肿, 封装到一个方法中去做代理\r\n  }\r\n\r\n  walk(data) {\r\n    const keys = Object.keys(data)\r\n    keys.forEach((key) => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n  arrayObserver(arr) {\r\n    arr.forEach((item) => {\r\n      observer(item)\r\n    })\r\n  }\r\n}\r\n// 对原有data(数据对象进行改造, 全部给setter,getter)\r\n// 使用闭包 用value保存data[key]的值\r\n// 当访问data的属性时, 实际上访问和修改的是闭包value中的值\r\nfunction defineReactive(data, key, value) {\r\n  observer(value) //如果对象的属性值仍为对象, 递归!\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      observer(newValue) //如果修改的属性依然为对象, 递归!\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function observer(data) {\r\n  // 在js中typeof null 也是object\r\n  if (typeof data !== 'object' || typeof data === null) {\r\n    return\r\n  }\r\n  if (data.__ob__) {\r\n    return\r\n  }\r\n  // 真正的处理data, 放在一个类里, 封装性比较好\r\n  new Observer(data)\r\n}\r\n","import { observer } from './observer/index.js'\r\n\r\nexport function initState(vm) {\r\n  initProps(vm)\r\n  initData(vm)\r\n  initMethod(vm)\r\n  initComputed(vm)\r\n  initWatch(vm)\r\n}\r\n\r\nfunction initProps(vm) {}\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data //对data是函数的情况执行处理,保证this是vm\r\n  //开始数据劫持\r\n  observer(data)\r\n}\r\nfunction initMethod(vm) {}\r\nfunction initComputed(vm) {}\r\nfunction initWatch(vm) {}\r\n","import { initState } from './state'\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    let vm = this\r\n    // 对做响应式!\r\n    initState(vm)\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  this.$options = options\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue) //公共方法挂载原型上\r\n\r\nexport default Vue\r\n"],"names":["oldArrayMethods","Array","prototype","protoMethods","Object","create","methods","forEach","method","inserted","args","slice","__ob__","arrayObserver","apply","defineProperty","target","attr","value","enumerable","configurable","Observer","data","isArray","__proto__","walk","keys","key","defineReactive","arr","item","observer","get","set","newValue","initState","vm","initData","$options","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}